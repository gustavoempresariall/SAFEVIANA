<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Editar Cliente - SafeViana</title>
  <link rel="icon" type="image/png" href="/imagens/icones/iconecabc.png">
  <link rel="stylesheet" href="{{ url_for('serve_css', filename='areacr.css') }}" />
  <style>
        /* Avatar + nome lado a lado no topo */
.topbar .user-info,
.topbar-right .user-info {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important;
  gap: 8px;
}

/* Tamanho e alinhamento do avatar */
.topbar .user-info .small-avatar,
.topbar .user-info .profile-avatar {
  width: 36px;
  height: 36px;
  flex: 0 0 36px;
  border-radius: 50%;
  overflow: hidden;
  background: #1e7a34; /* sua cor */
  color: #fff;
  font-weight: 700;
  font-size: 14px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Imagem do avatar */
.topbar .user-info .small-avatar img,
.topbar .user-info .profile-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  border-radius: 50%;
}

/* Nome sem quebrar linha estranha */
.topbar .user-info .user-name {
  white-space: nowrap;
  line-height: 1;
  display: inline-block;
  font-weight: 600;
  color: #111827;
}
    /* ====== Layout geral do formulário ====== */
    .content-section{
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:14px;
      padding:24px;
      box-shadow:0 6px 20px rgba(0,0,0,.06);
    }
    .content-section h2{
      margin:0 0 18px 0;
      color:#18763e;
      font-weight:800;
      letter-spacing:.2px;
    }
    /* Grid com 4 colunas: label, campo, label, campo */
    .content-section form{
      display:grid;
      grid-template-columns: minmax(160px,210px) 1fr minmax(160px,210px) 1fr;
      grid-auto-rows:auto;
      column-gap:22px;
      row-gap:14px;
      align-items:center;
    }
    .content-section form h2{ grid-column:1 / -1; }

    /* Rótulos à direita, alinhadinhos */
    .content-section form label{
      justify-self:end;
      color:#374151;
      font-weight:600;
      white-space:nowrap;
    }

    /* Campos */
    .content-section form input,
    .content-section form select,
    .content-section form textarea{
      width:100%;
      padding:10px 12px;
      border:1px solid #e5e7eb;
      border-radius:10px;
      background:#fff;
      color:#111827;
      font-variant-numeric: tabular-nums;
      transition:border-color .12s ease, box-shadow .12s ease, background .12s ease;
    }
    .content-section form input::placeholder,
    .content-section form textarea::placeholder{ color:#9ca3af; }
    .content-section form input:focus,
    .content-section form select:focus,
    .content-section form textarea:focus{
      outline:0;
      border-color:#0d4923;
      box-shadow:0 0 0 3px rgba(34,197,94,.25);
      background:#fcfffd;
    }

    /* Dica de ajuda (fica embaixo do campo CPF/CNPJ) */
    .hint{
      grid-column:2 / 3;        /* embaixo do campo da coluna 2 */
      margin-top:-2px;
      color:#6b7280;
      font-size:.85rem;
    }

    /* Textarea ocupa as duas colunas da direita */
    .content-section form textarea{
      grid-column:2 / 5;
      min-height:90px;
      resize:vertical;
    }

    /* ====== Botões ====== */
    .btn-salvar{
      grid-column:4;
      justify-self:end;
      padding:12px 20px;
      border-radius:10px;
      border:1px solid #15803d;
      background:linear-gradient(180deg,#1f8e49,#187d40);
      color:#fff;
      font-weight:800;
      letter-spacing:.2px;
      cursor:pointer;
      transition:transform .08s ease, box-shadow .15s ease, filter .15s ease;
      box-shadow:0 6px 14px rgba(34,197,94,.28), inset 0 0 0 1px rgba(255,255,255,.18);
    }
    .btn-salvar:hover{ filter:saturate(1.05); box-shadow:0 8px 18px rgba(34,197,94,.32); transform:translateY(-1px); }
    .btn-salvar:active{ transform:translateY(0); }

    .btn-cancelar{
      grid-column:1;
      justify-self:start;
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:12px 18px;
      border-radius:10px;
      background:#f3f4f6;
      color:#374151;
      text-decoration:none;
      border:1px solid #e5e7eb;
      font-weight:700;
      transition:background .15s ease, color .15s ease, box-shadow .15s ease;
    }
    .btn-cancelar:hover{ background:#e5e7eb; color:#111827; box-shadow:0 2px 8px rgba(0,0,0,.06); }

    /* Campo UF sempre em maiúsculas */
    #uf{ text-transform:uppercase; }

    /* ====== Responsivo ====== */
    @media (max-width: 1024px){
      .content-section form{
        grid-template-columns: 1fr;   /* empilha */
        row-gap:10px;
      }
      .content-section form label{ justify-self:start; }
      .hint{ grid-column:1 / -1; }
      .content-section form textarea{ grid-column:1 / -1; }
      .btn-cancelar{ grid-column:1; justify-self:stretch; text-align:center; }
      .btn-salvar{ grid-column:1; justify-self:stretch; }
    }

    /* ===== ÍCONES FINOS NA SIDEBAR (sem alterar HTML) ===== */
.sidebar nav ul{margin:0;padding:0;list-style:none}
.sidebar nav a{display:flex;align-items:center;gap:10px;text-decoration:none;color:#fff}

.sidebar nav .icon{
  width:22px;height:22px;flex:0 0 22px;display:inline-block;
  font-size:0; /* oculta o emoji */
  position:relative;
}
.sidebar nav .icon::before{
  content:"";display:block;width:22px;height:22px;
  background-repeat:no-repeat;background-position:center;background-size:22px 22px;
}

/* 1) Dashboard (casa) */
.sidebar nav li:nth-child(1) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><path d='M3 10.5L12 3l9 7.5'/><path d='M5 22h14a1 1 0 0 0 1-1V10.5L12 4 4 10.5V21a1 1 0 0 0 1 1z'/></svg>");
}

/* 2) Clientes (duas pessoas) */
.sidebar nav li:nth-child(2) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><path d='M16 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2'/><circle cx='9' cy='7' r='3'/><path d='M22 21v-2a4 4 0 0 0-3-3.87'/><path d='M16 3.13a4 4 0 0 1 0 7.75'/></svg>");
}

/* 3) Cotações/Relatórios (linha subindo) */
.sidebar nav li:nth-child(3) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><polyline points='23 6 13.5 15.5 9 11 1 19'/><polyline points='17 6 23 6 23 12'/></svg>");
}

/* 4) Apólices (arquivo com dobra) */
.sidebar nav li:nth-child(4) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><path d='M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z'/><polyline points='14 2 14 8 20 8'/><line x1='9' y1='13' x2='15' y2='13'/><line x1='9' y1='17' x2='13' y2='17'/></svg>");
}

/* 5) Propostas (lista/documento) */
.sidebar nav li:nth-child(5) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><rect x='3' y='2' width='14' height='20' rx='2'/><line x1='7' y1='8' x2='13' y2='8'/><line x1='7' y1='12' x2='13' y2='12'/><line x1='7' y1='16' x2='11' y2='16'/></svg>");
}

/* 6) Sinistros (triângulo de alerta) */
.sidebar nav li:nth-child(6) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><path d='M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z'/><line x1='12' y1='9' x2='12' y2='13'/><line x1='12' y1='17' x2='12.01' y2='17'/></svg>");
}

/* 7) Calendário */
.sidebar nav li:nth-child(7) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><rect x='3' y='4' width='18' height='18' rx='2' ry='2'/><line x1='16' y1='2' x2='16' y2='6'/><line x1='8' y1='2' x2='8' y2='6'/><line x1='3' y1='10' x2='21' y2='10'/></svg>");
}

/* Hover/ativo (opcional) */
.sidebar nav a:hover{opacity:.95}
.sidebar nav a.active{opacity:.9}

/* Deixa o título e ícone lado a lado */
.topbar-left h2 {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
  color: #fff;
}

/* Insere o ícone Apartment (Material Symbols Outlined) */
.topbar-left h2::before {
  font-family: 'Material Symbols Outlined';
  content: "apartment";           /* <- Ícone Apartment */
  font-size: 26px;
  font-weight: normal;
  line-height: 1;
  color: #fff;                    /* branco */
  display: inline-block;
}

  </style>
</head>
<body>
  <div class="container">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <aside class="sidebar">
      <div class="topbar-left"><h2>Area<span> Corretor</span></h2></div>
      <nav>
        <ul>
          <li><a href="{{ url_for('area_corretor') }}"><span class="icon"></span> Dashboard</a></li>
          <li><a href="{{ url_for('visualizar_clientes') }}"><span class="icon"></span> Clientes</a></li>
          <li><a href="{{ url_for('relatorio') }}"><span class="icon"></span> Cotações</a></li>
          <li><a href="{{ url_for('apolices') }}"><span class="icon"></span> Apólices</a></li>
          <li><a href="{{ url_for('propostas') }}"><span class="icon"></span> Propostas</a></li>
          <li><a href="{{ url_for('sinistros') }}"><span class="icon"></span> Sinistros</a></li>
          <li><a href="{{ url_for('calendario') }}"><span class="icon"></span> Calendário</a></li>
        </ul>
      </nav>
      <div class="bottom-section">
  <p class="admin-title">ADMINISTRAÇÃO</p>
  <ul>
    <li>
      <a href="https://wa.me/5518988076390?text=Olá%20SafeViana,%20preciso%20de%20suporte."
         target="_blank" rel="noopener" style="display:flex;align-items:center;gap:10px;color:#fff;text-decoration:none;">
        <span class="icon">❓Suporte</span>
      </a>
    </li>
  </ul>
</div>
    </aside>

    <main class="main-content">
      <header class="topbar">
        <button id="toggleSidebar" class="hamburger">☰</button>
        <h2>Safe<span>Viana</span></h2>
        <div class="topbar-right">
          
          <div class="user-info" id="userInfo">
  {% set nome = corretor_nome 
                or session.get('corretor_nome') 
                or (session.get('user') and session['user'].get('nome')) 
                or '' %}
  {% set foto = corretor_foto or session.get('corretor_foto') %}

  {# remove espaços, pega as 2 primeiras letras e sobe pra maiúsculas #}
  {% set iniciais = ((nome|trim|replace(' ', ''))[:2])|upper %}

  <div class="profile-avatar small-avatar" title="Meu Perfil">
    {% if foto %}
      <img src="{{ url_for('static', filename=foto|replace('static/','')) }}" alt="Foto de Perfil">
    {% else %}
      <span class="avatar-initials">{{ iniciais }}</span>
    {% endif %}
  </div>

  <span class="user-name">{{ nome }}</span>
</div>

      </header>

      <section class="content-section">
        <form method="POST" action="{{ url_for('editar_cliente', id=cliente.id) }}">
          <h2>Editar Cliente</h2>

          <label>Tipo de Pessoa:</label>
          <input type="text" name="tipo_pessoa" value="{{ cliente.tipo_pessoa }}" autocomplete="off" />

          <label>Nome:</label>
          <input type="text" name="nome" value="{{ cliente.nome }}" autocomplete="name" />

          <label>CPF/CNPJ:</label>
          <input type="text" name="cpfcnpj" id="cpfcnpj" value="{{ cliente.cpf_cnpj }}" inputmode="numeric" autocomplete="off" placeholder="000.000.000-00 ou 00.000.000/0000-00" />

          <label>Email:</label>
          <input type="email" name="email" value="{{ cliente.email }}" autocomplete="email" />

          <label>Telefone:</label>
          <input type="text" name="telefone" id="telefone" value="{{ cliente.telefone }}" inputmode="numeric" autocomplete="tel" placeholder="(00) 00000-0000" />

          <label>Nome Fantasia (Empresa):</label>
          <input type="text" name="empresa" value="{{ cliente.nome_fantasia }}" autocomplete="organization" />

          <label>RG / Inscrição Estadual:</label>
          <input type="text" name="rginsc" id="rginsc" value="{{ cliente.rg_inscricao }}" inputmode="numeric" autocomplete="off" placeholder="00.000.000-0" />

          <label>CEP:</label>
          <input type="text" name="cep" id="cep" value="{{ cliente.cep }}" inputmode="numeric" autocomplete="postal-code" placeholder="00000-000" />

          <label>Endereço:</label>
          <input type="text" name="endereco" value="{{ cliente.endereco }}" autocomplete="address-line1" />

          <label>Número:</label>
          <input type="text" name="numero" value="{{ cliente.numero }}" inputmode="numeric" autocomplete="address-line2" />

          <label>Bairro:</label>
          <input type="text" name="bairro" value="{{ cliente.bairro }}" autocomplete="address-level3" />

          <label>Cidade:</label>
          <input type="text" name="cidade" value="{{ cliente.cidade }}" autocomplete="address-level2" />

          <label>Estado:</label>
          <input type="text" name="estado" id="uf" value="{{ cliente.estado }}" maxlength="2" autocomplete="address-level1" />

          <label for="status">Status:</label>
          <select name="status" id="status">
            <option value="Ativo"    {% if cliente.status == 'Ativo' %}selected{% endif %}>Ativo</option>
            <option value="Pendente" {% if cliente.status == 'Pendente' %}selected{% endif %}>Pendente</option>
            <option value="Inativo"  {% if cliente.status == 'Inativo' %}selected{% endif %}>Inativo</option>
          </select>

          <label>Tipo de Seguro:</label>
          <input type="text" name="tipoSeguro" value="{{ cliente.tipo_seguro }}" />

          <label>Placa:</label>
          <input type="text" name="placa" value="{{ cliente.placa }}" />

          <label>Chassi:</label>
          <input type="text" name="chassi" value="{{ cliente.chassi }}" />

          <label>Renavam:</label>
          <input type="text" name="renavam" value="{{ cliente.renavam }}" />

          <label>Cor:</label>
          <input type="text" name="cor" value="{{ cliente.cor }}" />

          <label>Ano/Modelo:</label>
          <input type="text" name="ano" value="{{ cliente.ano_modelo }}" placeholder="Ex.: 2019/2020" />

          <label>Observações:</label>
          <textarea name="observacoes">{{ cliente.observacoes }}</textarea>

          <a href="{{ url_for('visualizar_clientes') }}" class="btn-cancelar">Cancelar</a>
          <button type="submit" class="btn-salvar">Salvar</button>
        </form>
      </section>
    </main>
  </div>

  <script>
    // ===== Helpers de formatação =====
    const onlyDigits = (v) => (v || '').replace(/\D+/g, '');

    function formatCpfCnpj(v) {
      const d = onlyDigits(v).slice(0, 14);
      if (d.length <= 11) {
        // CPF: 000.000.000-00
        return d
          .replace(/^(\d{3})(\d)/, '$1.$2')
          .replace(/^(\d{3})\.(\d{3})(\d)/, '$1.$2.$3')
          .replace(/^(\d{3})\.(\d{3})\.(\d{3})(\d)/, '$1.$2.$3-$4');
      }
      // CNPJ: 00.000.000/0000-00
      return d
        .replace(/^(\d{2})(\d)/, '$1.$2')
        .replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3')
        .replace(/^(\d{2})\.(\d{3})\.(\d{3})(\d)/, '$1.$2.$3/$4')
        .replace(/^(\d{2})\.(\d{3})\.(\d{3})\/(\d{4})(\d)/, '$1.$2.$3/$4-$5');
    }
    function formatPhone(v) {
      const d = onlyDigits(v).slice(0, 11);
      if (d.length <= 10) {
        return d.replace(/^(\d{2})(\d)/, '($1) $2').replace(/(\d{4})(\d)/, '$1-$2');
      }
      return d.replace(/^(\d{2})(\d)/, '($1) $2').replace(/(\d{5})(\d)/, '$1-$2');
    }
    function formatRG(v) {
      const d = onlyDigits(v).slice(0, 9);
      return d
        .replace(/^(\d{2})(\d)/, '$1.$2')
        .replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3')
        .replace(/^(\d{2})\.(\d{3})\.(\d{3})(\d)/, '$1.$2.$3-$4');
    }
    function formatCEP(v) {
      const d = onlyDigits(v).slice(0, 8);
      return d.replace(/^(\d{5})(\d)/, '$1-$2');
    }

    // Aplica máscaras em tempo real
    const $cpfcnpj = document.getElementById('cpfcnpj');
    const $telefone = document.getElementById('telefone');
    const $rg = document.getElementById('rginsc');
    const $cep = document.getElementById('cep');
    const $uf = document.getElementById('uf');

    if ($cpfcnpj) { $cpfcnpj.value = formatCpfCnpj($cpfcnpj.value); $cpfcnpj.addEventListener('input', e => e.target.value = formatCpfCnpj(e.target.value)); }
    if ($telefone) { $telefone.value = formatPhone($telefone.value); $telefone.addEventListener('input', e => e.target.value = formatPhone(e.target.value)); }
    if ($rg) { $rg.value = formatRG($rg.value); $rg.addEventListener('input', e => e.target.value = formatRG(e.target.value)); }
    if ($cep) { $cep.value = formatCEP($cep.value); $cep.addEventListener('input', e => e.target.value = formatCEP(e.target.value)); }
    if ($uf) { $uf.addEventListener('input', e => e.target.value = (e.target.value || '').toUpperCase().slice(0,2)); }

    // Sidebar
    document.getElementById('toggleSidebar').addEventListener('click', () => {
      document.querySelector('.sidebar').classList.toggle('collapsed');
    });
  </script>
</body>
</html>
