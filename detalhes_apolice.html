<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Detalhes da Ap√≥lice | SafeViana</title>
  <link rel="stylesheet" href="{{ url_for('serve_css', filename='areacr.css') }}" />
  <link rel="icon" type="image/png" href="/imagens/icones/iconecabc.png">
  <style>
    .detalhes-container { padding: 20px; background: #fff; border-radius: 12px; margin: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .detalhes-container h2 { margin-bottom: 20px; color: #333; }
    .detalhes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 15px; }
    .detalhes-item { background: #f9f9f9; padding: 10px; border-radius: 6px; font-size: 0.95rem; color: #444; }
    .detalhes-item input, .detalhes-item textarea, .detalhes-item select { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 6px; font-size: 0.95rem; }
    .detalhes-item textarea { resize: vertical; min-height: 60px; }
    .btn-voltar, .btn-action { display: inline-block; margin-top: 20px; padding: 10px 20px; background: #28a745; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; transition: background 0.3s; border: none; cursor: pointer; }
    .btn-voltar:hover, .btn-action:hover { background: #218838; }
    .btn-delete { background: #dc3545; }
    .btn-delete:hover { background: #c82333; }
    .button-container { display: flex; gap: 10px; }
    .section-title { grid-column: 1 / -1; font-weight: 700; color: #111; margin-top: 10px; }
    .muted { color: #6b7280; }

    /* ====== Card / Cont√™iner ====== */
.detalhes-container{
  max-width: 1200px;
  margin: 24px auto;
  padding: 24px 28px;
  background:#fff;
  border:1px solid #e5e7eb;
  border-radius:16px;
  box-shadow:0 6px 20px rgba(0,0,0,.06);
}
.detalhes-container h2{
  margin: 0 0 12px;
  color:#18763e;
  font-weight:800;
  letter-spacing:.2px;
}

/* ====== Grid ====== */
.detalhes-grid{
  display:grid;
  grid-template-columns: repeat(4, minmax(220px,1fr));
  gap:16px 18px;
  align-items:start;
}
.section-title{
  grid-column:1 / -1;
  margin:6px 0 2px;
  color:#0f172a;
  font-weight:800;
  font-size:1rem;
}
.section-title + *:not(.section-title){
  /* divis√≥ria sutil antes da pr√≥xima linha de itens */
  position:relative;
}
.section-title + *:not(.section-title)::before{
  content:"";
  position:absolute; left:0; right:0; top:-8px;
  height:1px; background:#eef2f7; border-radius:9999px;
}

/* ====== Itens (visualiza√ß√£o) ====== */
.detalhes-item{
  background:#f9fafb;
  border:1px solid #e5e7eb;
  border-radius:10px;
  padding:12px 14px;
  color:#374151;
  font-size:0.96rem;
}
.detalhes-item strong{
  display:block;
  color:#0f172a;
  font-weight:700;
  margin-bottom:4px;
}

/* ====== Campos (modo edi√ß√£o) ====== */
.detalhes-item input,
.detalhes-item select,
.detalhes-item textarea{
  width:100%; min-width:0; max-width:100%;
  padding:10px 12px;
  border:1px solid #d1d5db;
  border-radius:10px;
  background:#fff;
  color:#111827;
  font:inherit;
  transition:border-color .12s ease, box-shadow .12s ease, background .12s ease;
}
.detalhes-item textarea{ resize:vertical; min-height:90px; }
.detalhes-item input:focus,
.detalhes-item select:focus,
.detalhes-item textarea:focus{
  outline:0;
  border-color:#22c55e;
  box-shadow:0 0 0 3px rgba(34,197,94,.25);
  background:#fcfffd;
}

/* ====== Bot√µes (mesmo padr√£o do ‚ÄúNova Ap√≥lice‚Äù) ====== */
.button-container{
  display:flex; flex-wrap:wrap; gap:12px;
  margin-top:18px;
}

/* base */
.btn-action, .btn-voltar{
  --ring: rgba(34,197,94,.28); /* sobrescrito nos temas */
  display:inline-flex; align-items:center; gap:10px;
  padding:12px 18px;
  border-radius:10px;
  font-weight:700; line-height:1;
  border:1px solid transparent;
  cursor:pointer; text-decoration:none; user-select:none;
  transition: background .18s ease, box-shadow .18s ease, transform .06s ease, color .18s ease, border-color .18s ease;
}

/* prim√°rio (verde) */
.btn-action{
  --btn-bg:#15803d; --btn-bg-hover:#166534; --btn-bg-active:#14532d; --btn-border:#0f3d21;
  background:var(--btn-bg); color:#fff; border-color:var(--btn-border);
  box-shadow:0 1px 2px rgba(16,24,40,.05), 0 6px 14px rgba(21,128,61,.18);
}
.btn-action:hover{ background:var(--btn-bg-hover); transform:translateY(-1px); box-shadow:0 2px 4px rgba(16,24,40,.06), 0 10px 20px rgba(21,128,61,.22); }
.btn-action:active{ background:var(--btn-bg-active); transform:translateY(0); }
.btn-action:focus-visible{ outline:0; box-shadow:0 0 0 4px var(--ring), 0 1px 2px rgba(16,24,40,.05), 0 6px 14px rgba(21,128,61,.18); }

/* secund√°rio (voltar ‚Äì neutro) */
.btn-voltar{
  --ring: rgba(15,23,42,.18);
  background:#f3f4f6; color:#0f172a; border-color:#e5e7eb;
  box-shadow:0 1px 2px rgba(16,24,40,.04);
}
.btn-voltar:hover{ background:#e7e9ee; }
.btn-voltar:focus-visible{ outline:0; box-shadow:0 0 0 3px var(--ring); }

/* perigo (excluir) */
.btn-delete{
  --ring: rgba(239,68,68,.28);
  background:#dc2626; color:#fff; border-color:#7f1d1d;
  box-shadow:0 1px 2px rgba(16,24,40,.05), 0 6px 14px rgba(220,38,38,.16);
}
.btn-delete:hover{ background:#b91c1c; transform:translateY(-1px); }
.btn-delete:active{ background:#991b1b; transform:translateY(0); }
.btn-delete:focus-visible{ outline:0; box-shadow:0 0 0 4px var(--ring), 0 1px 2px rgba(16,24,40,.05); }

/* ====== Responsivo ====== */
@media (max-width:1100px){
  .detalhes-grid{ grid-template-columns: repeat(3, minmax(220px,1fr)); }
}
@media (max-width:820px){
  .detalhes-grid{ grid-template-columns: repeat(2, minmax(220px,1fr)); }
}
@media (max-width:560px){
  .detalhes-grid{ grid-template-columns:1fr; }
  .button-container{ gap:10px; }
  .btn-action, .btn-voltar, .btn-delete{ width:100%; justify-content:center; }
}
/* ========= √çcones por CSS (sem alterar HTML) ========= */
/* base do ‚Äúbloco do √≠cone‚Äù */
.btn-voltar::before,
#edit-btn::before,
#save-btn::before,
#cancel-btn::before,
#delete-btn::before,
.btn-detalhes::before{
  display:inline-grid;
  place-items:center;
  width:20px; height:20px;
  border-radius:6px;
  margin-right:8px;
  line-height:1;
  font-size:14px;           /* tamanho do emoji */
}

/* fundos do bloco do √≠cone por tipo de bot√£o */
.btn-action::before, .btn-detalhes::before{            /* verdes (prim√°rios) */
  background:rgba(255,255,255,.16);
}
.btn-voltar::before{                                    /* neutro */
  background:rgba(15,23,42,.08);
}
.btn-delete::before{                                    /* perigo */
  background:rgba(255,255,255,.14);
}

/* conte√∫dos (emoji) */
.btn-voltar::before{          content:"\2190"; }        /* ‚Üê */
#edit-btn::before{            content:"\270F\FE0F"; }   /* ‚úèÔ∏è */
#save-btn::before{            content:"\1F4BE"; }       /* üíæ */
#cancel-btn::before{          content:"\2716\FE0F"; }   /* ‚úñÔ∏è */
#delete-btn::before{          content:"\1F5D1\FE0F"; }  /* üóëÔ∏è */

/* opcional: refor√ßa o espa√ßamento entre √≠cone e texto
   caso algum bot√£o n√£o tenha 'gap' na classe base */
.btn-voltar, #edit-btn, #save-btn, #cancel-btn, #delete-btn, .btn-detalhes{
  display:inline-flex; align-items:center;
}

/* ===== √çCONES FINOS NA SIDEBAR (sem alterar HTML) ===== */
.sidebar nav ul{margin:0;padding:0;list-style:none}
.sidebar nav a{display:flex;align-items:center;gap:10px;text-decoration:none;color:#fff}

.sidebar nav .icon{
  width:22px;height:22px;flex:0 0 22px;display:inline-block;
  font-size:0; /* oculta o emoji */
  position:relative;
}
.sidebar nav .icon::before{
  content:"";display:block;width:22px;height:22px;
  background-repeat:no-repeat;background-position:center;background-size:22px 22px;
}

/* 1) Dashboard (casa) */
.sidebar nav li:nth-child(1) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><path d='M3 10.5L12 3l9 7.5'/><path d='M5 22h14a1 1 0 0 0 1-1V10.5L12 4 4 10.5V21a1 1 0 0 0 1 1z'/></svg>");
}

/* 2) Clientes (duas pessoas) */
.sidebar nav li:nth-child(2) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><path d='M16 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2'/><circle cx='9' cy='7' r='3'/><path d='M22 21v-2a4 4 0 0 0-3-3.87'/><path d='M16 3.13a4 4 0 0 1 0 7.75'/></svg>");
}

/* 3) Cota√ß√µes/Relat√≥rios (linha subindo) */
.sidebar nav li:nth-child(3) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><polyline points='23 6 13.5 15.5 9 11 1 19'/><polyline points='17 6 23 6 23 12'/></svg>");
}

/* 4) Ap√≥lices (arquivo com dobra) */
.sidebar nav li:nth-child(4) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><path d='M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z'/><polyline points='14 2 14 8 20 8'/><line x1='9' y1='13' x2='15' y2='13'/><line x1='9' y1='17' x2='13' y2='17'/></svg>");
}

/* 5) Propostas (lista/documento) */
.sidebar nav li:nth-child(5) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><rect x='3' y='2' width='14' height='20' rx='2'/><line x1='7' y1='8' x2='13' y2='8'/><line x1='7' y1='12' x2='13' y2='12'/><line x1='7' y1='16' x2='11' y2='16'/></svg>");
}

/* 6) Sinistros (tri√¢ngulo de alerta) */
.sidebar nav li:nth-child(6) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><path d='M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z'/><line x1='12' y1='9' x2='12' y2='13'/><line x1='12' y1='17' x2='12.01' y2='17'/></svg>");
}

/* 7) Calend√°rio */
.sidebar nav li:nth-child(7) .icon::before{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><rect x='3' y='4' width='18' height='18' rx='2' ry='2'/><line x1='16' y1='2' x2='16' y2='6'/><line x1='8' y1='2' x2='8' y2='6'/><line x1='3' y1='10' x2='21' y2='10'/></svg>");
}

/* Hover/ativo (opcional) */
.sidebar nav a:hover{opacity:.95}
.sidebar nav a.active{opacity:.9}

/* Deixa o t√≠tulo e √≠cone lado a lado */
.topbar-left h2 {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
  color: #fff;
}

/* Insere o √≠cone Apartment (Material Symbols Outlined) */
.topbar-left h2::before {
  font-family: 'Material Symbols Outlined';
  content: "apartment";           /* <- √çcone Apartment */
  font-size: 26px;
  font-weight: normal;
  line-height: 1;
  color: #fff;                    /* branco */
  display: inline-block;
}

        /* Avatar + nome lado a lado no topo */
.topbar .user-info,
.topbar-right .user-info {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important;
  gap: 8px;
}

/* Tamanho e alinhamento do avatar */
.topbar .user-info .small-avatar,
.topbar .user-info .profile-avatar {
  width: 36px;
  height: 36px;
  flex: 0 0 36px;
  border-radius: 50%;
  overflow: hidden;
  background: #1e7a34; /* sua cor */
  color: #fff;
  font-weight: 700;
  font-size: 14px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Imagem do avatar */
.topbar .user-info .small-avatar img,
.topbar .user-info .profile-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  border-radius: 50%;
}

/* Nome sem quebrar linha estranha */
.topbar .user-info .user-name {
  white-space: nowrap;
  line-height: 1;
  display: inline-block;
  font-weight: 600;
  color: #111827;
}
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
      <div class="topbar-left">
        <div class="topbar-left"><h2>Area<span> Corretor</span></h2></div>
      </div>
      <nav>
        <ul>
          <li><a href="{{ url_for('area_corretor') }}"><span class="icon"></span> Dashboard</a></li>
          <li><a href="{{ url_for('visualizar_clientes') }}"><span class="icon"></span> Clientes</a></li>
          <li><a href="{{ url_for('relatorio') }}"><span class="icon"></span> Cota√ß√µes</a></li>
          <li><a href="{{ url_for('apolices') }}"><span class="icon"></span> Ap√≥lices</a></li>
          <li><a href="{{ url_for('propostas') }}"><span class="icon"></span> Propostas</a></li>
          <li><a href="{{ url_for('sinistros') }}"><span class="icon"></span> Sinistros</a></li>
          <li><a href="{{ url_for('calendario') }}"><span class="icon"></span> Calend√°rio</a></li>
        </ul>
      </nav>
      <div class="bottom-section">
  <p class="admin-title">ADMINISTRA√á√ÉO</p>
  <ul>
    <li>
      <a href="https://wa.me/5518988076390?text=Ol√°%20SafeViana,%20preciso%20de%20suporte."
         target="_blank" rel="noopener" style="display:flex;align-items:center;gap:10px;color:#fff;text-decoration:none;">
        <span class="icon">‚ùìSuporte</span>
      </a>
    </li>
  </ul>
</div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Topbar -->
      <header class="topbar">
        <button id="toggleSidebar" class="hamburger">‚ò∞</button>
        <h2>Safe<span>Viana</span></h2>
        <div class="topbar-right">

          <div class="user-info" id="userInfo">
            <div class="profile-avatar small-avatar" title="Meu Perfil">
              {% if corretor_foto %}
                <img src="{{ url_for('static', filename=corretor_foto|replace('static/','')) }}" alt="Foto de Perfil">
              {% elif session.get('corretor_foto') %}
                <img src="{{ url_for('static', filename=session.get('corretor_foto')|replace('static/','')) }}" alt="Foto de Perfil">
              {% else %}
                <span class="avatar-initials">{{ (corretor_nome or '')[:2].upper() }}</span>
              {% endif %}
            </div>
            <span class="user-name">{{ corretor_nome }}</span>
          </div>
        </div>
      </header>

      <div class="detalhes-container">
        <h2>Detalhes da Ap√≥lice</h2>

        <!-- ======= MODO VISUALIZA√á√ÉO ======= -->
        <div id="view-mode" class="detalhes-grid">
          <div class="section-title">Dados do Cliente</div>
          <div class="detalhes-item"><strong>Nome:</strong> {{ cliente.nome }}</div>
          <div class="detalhes-item"><strong>Tipo Pessoa:</strong> {{ cliente.tipo_pessoa }}</div>
          <div class="detalhes-item"><strong>CPF/CNPJ:</strong> {{ cliente.cpf_cnpj }}</div>
          <div class="detalhes-item"><strong>Email:</strong> {{ cliente.email }}</div>
          <div class="detalhes-item"><strong>Telefone:</strong> {{ cliente.telefone }}</div>
          <div class="detalhes-item"><strong>Endere√ßo:</strong> {{ cliente.endereco }}{% if cliente.numero %} - {{ cliente.numero }}{% endif %}</div>
          <div class="detalhes-item"><strong>Cidade/UF:</strong> {{ cliente.cidade }} - {{ cliente.estado }}</div>

          <div class="section-title">Dados da Ap√≥lice</div>
          <div class="detalhes-item"><strong>N¬∫ Ap√≥lice:</strong> {{ ap.numero_apolice or '-' }}</div>
          <div class="detalhes-item"><strong>N¬∫ Proposta:</strong> {{ ap.numero_proposta or '-' }}</div>
          <div class="detalhes-item"><strong>Tipo Ap√≥lice:</strong> {{ ap.tipo_apolice or '-' }}</div>
          <div class="detalhes-item"><strong>Seguradora:</strong> {{ ap.seguradora or '-' }}</div>
          <div class="detalhes-item"><strong>Valor Ap√≥lice:</strong> R$ {{ "%.2f"|format(ap.valor_apolice or 0) }}</div>
          
          <div class="detalhes-item"><strong>Seguradora:</strong> {{ ap.seguradora or '-' }}</div>


          <div class="detalhes-item">
            <strong>Hor√°rio de In√≠cio:</strong>
            {% if ap.data_inicio %}
              {% if ap.data_inicio is string %}
                {{ ap.data_inicio.replace('T',' ')[:16] }}
              {% else %}
                {{ ap.data_inicio.strftime('%d/%m/%Y %H:%M') }}
              {% endif %}
            {% else %}-{% endif %}
          </div>

          <div class="detalhes-item">
            <strong>V√°lido at√©:</strong>
            {% if ap.data_termino %}
              {% if ap.data_termino is string %}
                {{ ap.data_termino.replace('T',' ')[:16] }}
              {% else %}
                {{ ap.data_termino.strftime('%d/%m/%Y %H:%M') }}
              {% endif %}
            {% else %}-{% endif %}
          </div>

          <div class="detalhes-item"><strong>Primeiro Vencimento:</strong> {{ (ap.primeiro_vencimento|string)[:10] if ap.primeiro_vencimento else '-' }}</div>
          <div class="detalhes-item"><strong>Parcelas:</strong> {{ ap.parcelas or '-' }}</div>

          <div class="detalhes-item">
            <strong>Forma de Pagamento:</strong>
            {% set fp = ap.forma_pagamento %}
            {% if fp == 'CartaoCredito' %}Cart√£o de Cr√©dito
            {% elif fp == 'DebitoConta' %}D√©bito em Conta
            {% elif fp %}{{ fp }}
            {% else %}-{% endif %}
          </div>

          <div class="detalhes-item"><strong>Ve√≠culo:</strong> {{ ap.veiculo or '-' }}</div>
          <div class="detalhes-item"><strong>Placa:</strong> {{ ap.placa or '-' }}</div>
          <div class="detalhes-item"><strong>Chassi:</strong> {{ ap.chassi or '-' }}</div>
          <div class="detalhes-item"><strong>Renavam:</strong> {{ ap.renavam or '-' }}</div>
          <div class="detalhes-item"><strong>Cor:</strong> {{ ap.cor or '-' }}</div>
          <div class="detalhes-item"><strong>Ano Modelo:</strong> {{ ap.ano_modelo or '-' }}</div>

          <div class="detalhes-item"><strong>Status:</strong>
            {% set s = ap.status_front or ap.status %}
            {{ 'Ativo' if s in ['Ativo','Ativa'] else ('Inativo' if s in ['Inativo','Cancelada'] else s) }}
          </div>

          <div class="detalhes-item" style="grid-column: 1 / -1;">
            <strong>Observa√ß√µes:</strong> {{ ap.observacoes or '-' }}
          </div>
        </div>

        <!-- ======= MODO EDI√á√ÉO (POST para atualizar AP√ìLICE) ======= -->
        <form id="edit-mode" class="detalhes-grid" style="display: none;"
              action="{{ url_for('detalhes_cliente', id=ap.id) }}" method="POST">

          <div class="section-title">Editar Ap√≥lice</div>

          <div class="detalhes-item">
            <strong>N¬∫ Ap√≥lice:</strong>
            <input type="text" name="numero_apolice" value="{{ ap.numero_apolice or '' }}">
          </div>

          <div class="detalhes-item">
            <strong>N¬∫ Proposta:</strong>
            <input type="text" name="numero_proposta" value="{{ ap.numero_proposta or '' }}">
          </div>

          <div class="detalhes-item">
            <strong>Status:</strong>
            {% set sf = ap.status_front or ap.status %}
            <select name="status" required>
              <option value="Ativo"     {{ 'selected' if sf in ['Ativo','Ativa'] else '' }}>Ativo</option>
              <option value="Pendente"  {{ 'selected' if sf == 'Pendente' else '' }}>Pendente</option>
              <option value="Inativo"   {{ 'selected' if sf in ['Inativo','Cancelada'] else '' }}>Inativo</option>
              <option value="Vencida"   {{ 'selected' if sf == 'Vencida' else '' }}>Vencida</option>
            </select>
          </div>

          <div class="detalhes-item">
            <strong>Tipo de Ap√≥lice:</strong>
            <input type="text" name="tipo_apolice" value="{{ ap.tipo_apolice or '' }}">
          </div>

          <div class="detalhes-item">
  <strong>Seguradora:</strong>
  <select name="seguradora" required>
    <option value="" disabled>Selecione a seguradora</option>
    {% for seg in seguradoras %}
      <option value="{{ seg.nome }}" {{ 'selected' if ap.seguradora == seg.nome else '' }}>{{ seg.nome }}</option>
    {% endfor %}
  </select>
</div>



          <div class="detalhes-item">
            <strong>Valor da Ap√≥lice (R$):</strong>
            <input type="number" step="0.01" name="valor_apolice" value="{{ ap.valor_apolice or '' }}">
          </div>

          <div class="detalhes-item">
            <strong>Hor√°rio de In√≠cio:</strong>
            <input type="datetime-local" name="data_inicio"
                   value="{% if ap.data_inicio %}{{ (ap.data_inicio.strftime('%Y-%m-%dT%H:%M') if not (ap.data_inicio is string) else ap.data_inicio[:16].replace(' ','T')) }}{% endif %}">
          </div>

          <div class="detalhes-item">
            <strong>V√°lido at√©:</strong>
            <input type="datetime-local" name="data_termino"
                   value="{% if ap.data_termino %}{{ (ap.data_termino.strftime('%Y-%m-%dT%H:%M') if not (ap.data_termino is string) else ap.data_termino[:16].replace(' ','T')) }}{% endif %}">
          </div>

          <div class="detalhes-item">
            <strong>Primeiro Vencimento:</strong>
            <input type="date" name="primeiro_vencimento"
                   value="{{ (ap.primeiro_vencimento|string)[:10] if ap.primeiro_vencimento else '' }}">
          </div>

          <div class="detalhes-item">
            <strong>Parcelas:</strong>
            <input type="number" name="parcelas" min="1" step="1" value="{{ ap.parcelas or '' }}">
          </div>

          <div class="detalhes-item">
            <strong>Forma de Pagamento:</strong>
            {% set fp_sel = ap.forma_pagamento or 'Boleto' %}
            {% set fps = formas_pagamento or ['Boleto','CartaoCredito','Pix','DebitoConta','Transferencia','Dinheiro'] %}
            <select name="forma_pagamento" required>
              {% for fp in fps %}
                {% set label =
                  'Cart√£o de Cr√©dito' if fp == 'CartaoCredito' else
                  'D√©bito em Conta'   if fp == 'DebitoConta'   else
                  fp %}
                <option value="{{ fp }}" {{ 'selected' if fp_sel == fp else '' }}>{{ label }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="detalhes-item">
            <strong>Ve√≠culo:</strong>
            <input type="text" name="veiculo" placeholder="Ex.: Titan KS" value="{{ ap.veiculo or '' }}">
          </div>

          <div class="detalhes-item"><strong>Placa:</strong>
            <input type="text" name="placa" value="{{ ap.placa or '' }}">
          </div>

          <div class="detalhes-item"><strong>Chassi:</strong>
            <input type="text" name="chassi" value="{{ ap.chassi or '' }}">
          </div>

          <div class="detalhes-item"><strong>Renavam:</strong>
            <input type="text" name="renavam" value="{{ ap.renavam or '' }}">
          </div>

          <div class="detalhes-item"><strong>Cor:</strong>
            <input type="text" name="cor" value="{{ ap.cor or '' }}">
          </div>

          <div class="detalhes-item"><strong>Ano Modelo:</strong>
            <input type="text" name="ano_modelo" value="{{ ap.ano_modelo or '' }}">
          </div>

          <div class="detalhes-item" style="grid-column: 1 / -1;">
            <strong>Observa√ß√µes:</strong>
            <textarea name="observacoes">{{ ap.observacoes or '' }}</textarea>
          </div>
        </form>

        <form id="edit-mode" class="detalhes-grid" style="display: none;"
      action="{{ url_for('detalhes_cliente', id=ap.id) }}" method="POST">

  <input type="hidden" name="id" value="{{ ap.id }}">


        <!-- Formul√°rio para exclus√£o da ap√≥lice -->
        <form id="delete-form" action="{{ url_for('excluir_apolice', id=ap.id) }}" method="POST" style="display: none;">
          <input type="hidden" name="id" value="{{ ap.id }}">
        </form>

        <!-- Bot√µes -->
        <div class="button-container">
          <a href="{{ url_for('apolices') }}" class="btn-voltar"> Voltar</a>
          <button id="edit-btn" class="btn-action"> Editar</button>
          <button id="delete-btn" class="btn-action btn-delete"> Excluir</button>
          <button id="save-btn" class="btn-action" style="display: none;"> Salvar</button>
          <button id="cancel-btn" class="btn-action" style="display: none;"> Cancelar</button>
        </div>
      </div>
    </main>
  </div>

  <script>
    const toggleBtn = document.getElementById('toggleSidebar');
    const sidebar = document.querySelector('.sidebar');
    toggleBtn.addEventListener('click', () => { sidebar.classList.toggle('collapsed'); });

    const viewMode  = document.getElementById('view-mode');
    const editMode  = document.getElementById('edit-mode');
    const editBtn   = document.getElementById('edit-btn');
    const saveBtn   = document.getElementById('save-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const deleteBtn = document.getElementById('delete-btn');
    const deleteForm= document.getElementById('delete-form');

    // Alternar para modo de edi√ß√£o
    editBtn.addEventListener('click', () => {
      viewMode.style.display = 'none';
      editMode.style.display = 'grid';
      editBtn.style.display = 'none';
      deleteBtn.style.display = 'none';
      saveBtn.style.display = 'inline-block';
      cancelBtn.style.display = 'inline-block';
    });

    // Cancelar edi√ß√£o
    cancelBtn.addEventListener('click', () => {
      viewMode.style.display = 'grid';
      editMode.style.display = 'none';
      editBtn.style.display = 'inline-block';
      deleteBtn.style.display = 'inline-block';
      saveBtn.style.display = 'none';
      cancelBtn.style.display = 'none';
    });

    // Salvar (submete o formul√°rio de edi√ß√£o)
    saveBtn.addEventListener('click', () => { editMode.submit(); });

    // Excluir (com confirma√ß√£o)
    deleteBtn.addEventListener('click', () => {
      if (confirm('Tem certeza que deseja excluir esta ap√≥lice? Esta a√ß√£o n√£o pode ser desfeita.')) {
        deleteForm.submit();
      }
    });
  </script>
</body>
</html>
